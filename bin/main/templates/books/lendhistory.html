<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
	<head>
		<meta charset="UTF-8">
		<title>貸出履歴</title>
		<script type="text/javascript" th:src="@{/js/jquery-3.6.3.min.js}"></script>
		<script src="/docs/4.2/dist/js/bootstrap.bundle.min.js"
			th:src="@{/js/bootstrap.bundle.min.js}"
			integrity="sha384-zDnhMsjVZfS3hiP7oCBRmfjkQC4fzxVxFhBx8Hkz2aZX8gEvA/jsP3eXRCvzTofP"
			crossorigin="anonymous"></script>
		<script type="text/javascript" th:src="@{/js/management.js}"></script>
		<link href="/docs/4.2/dist/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
		<link th:href="@{/css/style.css}" rel="stylesheet">
		<link th:href="@{/css/icomoon.css}" rel="stylesheet">
	</head>
	<body>
		<!-- ナビゲーションバー呼び出し -->
		<div th:replace="block/navbar :: navbar"></div>
		<a href="#" id="page-top" class="icon-chevron-circle-up"></a>
		<div class="container-fluid">
			<div class="row justify-content-center">
				<div class="col-7">
					<div class="line-bottom font-size-20 pb-2">貸出履歴</div>
					<div id="lend-alert"></div>
					<div th:if="${none}" th:text="${none}" class="text-danger"></div>

					<!-- 各履歴 -->
					<div class="line-bottom pt-4 pb-4" th:each="obj : ${lendHistory}" th:object="${obj}">
						<div class="row side-margin-0 book">
							<div class="col-2">
								<a th:href="@{/book/{id}(id=${obj.bookNameId})}">
									<img id="book-img" th:if="${obj.img != null}" th:src="|/img/${obj.img}|" width="128" height="160">
									<img id="book-img" th:if="${obj.img == null}" th:src="@{/img/no_image.png}" width="128" height="160">
								</a>
							</div>
							<div class="col-10">
								<div class="row ml-1">
									<div class="col-12 mb-4">
										<a th:href="@{/book/{id}(id=${obj.bookNameId})}">
											<h5 id="book-title" class="font-weight-bold text-info" th:text="${obj.title}"></h5>
										</a>
									</div>

									<div class="col-3 pr-0">
										<input id="book-id" class="d-none" name="id" th:value="${obj.bookNameId}">
										<div><small>著者：<span id="book-author" th:text="${obj.author}"></span></small></div>
										<div><small>ジャンル：<span id="book-name" th:text="${obj.name}"></span></small></div>
										<div><small>出版社：<span id="book-publisher" th:text="${obj.publisher}"></span></small></div>
										<div class="mt-1"><small>レビュー：</small><span>☆</span><span>☆</span><span>☆</span><span>☆</span><span>☆</span></div>
										<div id="book-detail" class="d-none" th:text="${obj.detail}"></div>
									</div>

									<div class="col-4">
										<div><span class="mb-2" th:text="|貸出日：${#temporals.format(obj.lendDate, 'yyyy年MM月dd日')}|"></span></div>
										<div><span th:text="|返却日：${#temporals.format(obj.returnDate, 'yyyy年MM月dd日')}|"></span></div>
									</div>

									<div class="col-5">
										<button type="button" class="btn btn-outline-secondary col-12 mb-2">レビューを書く</button>

										<!-- sameBook判定 -->
										<th:block th:if="${obj.lendCount > 0}">
											<!-- すでに借りている場合 -->
											<button type="button"
												class="btn btn-secondary col-12 mb-2"
												th:if="${obj.sameBook}"
												disabled>
												この書籍を借りています
											</button>

											<!-- 借りていない場合 -->
											<button type="button"
												class="book-lend btn btn-primary col-12 mb-2"
												th:unless="${obj.sameBook}"
												data-toggle="modal"
												data-target="#lendModal"
												th:data-booknameid="${obj.bookNameId}"
												th:data-title="${obj.title}"
												th:data-author="${obj.author}"
												th:data-publisher="${obj.publisher}"
												th:data-detail="${obj.detail}"
												th:data-img="${obj.img}">
												この書籍を再度借りる
											</button>
										</th:block>

										<!-- 在庫なし -->
										<th:block th:if="${obj.lendCount == 0}">
											<button type="button" class="btn btn-primary col-12 mb-2" disabled>在庫がありません</button>
										</th:block>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- モーダル -->
					<div class="modal fade" id="lendModal" tabindex="-1" role="dialog">
						<div class="modal-dialog modal-lg modal-dialog-centered" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<span id="modal-book-title" class="font-weight-bold text-info"></span>
									<button type="button" class="close" data-dismiss="modal"><span>×</span></button>
								</div>
								<form id="modal-form" method="POST">
									<div class="modal-body">
										<div class="row side-margin-0">
											<div class="col-3">
												<img id="modal-book-img" width="160" height="200" src="">
											</div>
											<div class="col-9">
												<div class="row">
													<div class="col-4">
														<div><small>著者：<span id="modal-book-author"></span></small></div>
														<div><small>ジャンル：<span id="modal-book-name"></span></small></div>
														<div><small>出版社：<span id="modal-book-publisher"></span></small></div>
														<div class="mt-1"><small>レビュー：</small><span>☆</span><span>☆</span><span>☆</span><span>☆</span><span>☆</span></div>
													</div>
													<div class="col-8">
														<small>
															<div class="font-weight-bold line-bottom">＜本の内容＞</div>
															<div id="modal-book-detail"></div>
														</small>
													</div>
												</div>
											</div>
											<input id="modal-book-id" class="d-none" name="bookNameId" value="" type="text">
										</div>
									</div>
									<div class="modal-footer">
										<!-- ボタンのsameBook対応 -->
										<th:block th:if="${obj.lendCount > 0}">
											<button type="button"
												class="book-lend btn col-12"
												th:classappend="${obj.sameBook} ? 'btn-secondary' : 'btn-primary'"
												th:disabled="${obj.sameBook}"
												th:text="${obj.sameBook} ? 'この書籍を借りています' : 'この書籍を再度借りる'">
											</button>
										</th:block>
										<th:block th:if="${obj.lendCount == 0}">
											<button type="button" class="btn btn-primary col-12" disabled>在庫がありません</button>
										</th:block>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
